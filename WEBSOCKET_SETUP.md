# Настройка WebSocket для Pixel Streaming

## Описание решения

Реализована система комнат на основе WebSocket, где:
- Все пользователи подключаются через сайт
- Комнаты создаются на основе `projectUrl` (ссылки на проект)
- Администратор может управлять видео, зрители только смотрят
- Все видят один экран (синхронизация через streaming pixel)
- Список подключенных пользователей обновляется в реальном времени

## Установка и запуск WebSocket сервера

1. Установите зависимости:
```bash
npm install socket.io express cors
```

2. Запустите сервер:
```bash
node server-example.js
```

Сервер будет работать на `http://localhost:3001`

## Настройка клиента

В файле `.env` или `vite.config.js` укажите адрес WebSocket сервера:

```env
VITE_WS_SERVER_URL=http://localhost:3001
```

Или измените в `src/components/PixelStreamingViewer.vue`:
```javascript
const wsServerUrl = "http://your-websocket-server:3001";
```

## Как это работает

1. **При входе**: Пользователь вводит имя, ссылку на проект и выбирает роль
2. **Создание комнаты**: На основе `projectUrl` генерируется ID комнаты
3. **Подключение**: Все пользователи с одной ссылкой попадают в одну комнату
4. **Роли**:
   - **Администратор** (`admin`): Может управлять видео, видит всех пользователей
   - **Зритель** (`viewer`): Только просмотр, read-only режим в iframe
5. **Синхронизация**: Все видят один экран через streaming pixel
6. **Список пользователей**: Обновляется в реальном времени через WebSocket

## API WebSocket сервера

### События от клиента:

- `join-room`: Присоединение к комнате
  ```javascript
  {
    roomId: "string",
    user: {
      name: "string",
      role: "admin" | "viewer",
      id: "socket.id"
    }
  }
  ```

- `leave-room`: Покидание комнаты
  ```javascript
  {
    roomId: "string"
  }
  ```

- `control-command`: Команда управления (только от администратора)
  ```javascript
  {
    roomId: "string",
    command: "string",
    data: {}
  }
  ```

### События от сервера:

- `users-update`: Обновление списка пользователей
  ```javascript
  [
    {
      id: "string",
      name: "string",
      role: "admin" | "viewer"
    }
  ]
  ```

- `control-command`: Команда управления (для синхронизации)
  ```javascript
  {
    command: "string",
    data: {}
  }
  ```

## Преимущества этого подхода

1. ✅ Единый интерфейс для всех пользователей
2. ✅ Полный контроль доступа через WebSocket
3. ✅ Синхронизация списка пользователей в реальном времени
4. ✅ Возможность расширения функциональности
5. ✅ Все видят один экран (обеспечивается streaming pixel)
6. ✅ Встроенные функции общения streaming pixel доступны всем

## Дальнейшее развитие

- Добавить текстовый чат через WebSocket
- Добавить голосовое общение
- Сохранение истории комнат
- Статистика подключений
- Уведомления о событиях

